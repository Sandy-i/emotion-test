<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="æˆ‘çš„æƒ…ç»ªé¢—ç²’åº¦æµ‹è¯•ç»“æœ - æ˜Ÿç«å¥‡ç¼˜">
    <title>æˆ‘çš„æƒ…ç»ªé¢—ç²’åº¦æµ‹è¯•ç»“æœ</title>
    <link rel="stylesheet" href="common.css">
    <style>
        body {
            padding-bottom: 80px;
        }

        .result-container {
            max-width: 750px;
            margin: 0 auto;
            padding: var(--space-3);
        }

        .wave-decoration {
            height: 180px;
        }

        .result-content {
            position: relative;
            z-index: 1;
            padding-top: 120px;
        }

        /* ç»“æœå¤´éƒ¨ */
        .result-header {
            text-align: center;
            margin-bottom: var(--space-4);
        }

        .result-icon {
            font-size: 72px;
            margin-bottom: var(--space-2);
            animation: iconEntrance 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes iconEntrance {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(0);
                opacity: 1;
            }
        }

        .result-title {
            font-size: 26px;
            font-weight: 700;
            background: var(--gradient-warm);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-2);
            line-height: 1.3;
        }

        .result-stars {
            font-size: 32px;
            color: var(--emotion-positive);
            margin-bottom: var(--space-2);
            animation: starShine 1.5s ease-in-out infinite;
        }

        @keyframes starShine {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
                transform: scale(1.05);
            }
        }

        .result-score {
            font-size: 16px;
            color: var(--gray-600);
            margin-bottom: 4px;
        }

        .result-percentage {
            font-size: 24px;
            font-weight: 700;
            background: var(--gradient-warm);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* é›·è¾¾å›¾å¡ç‰‡ */
        .radar-card {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            margin-bottom: var(--space-3);
            box-shadow: var(--shadow-md);
        }

        .radar-card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-3);
            text-align: center;
        }

        .radar-container {
            position: relative;
            width: 100%;
            height: 300px;
            margin-bottom: var(--space-3);
        }

        #radarCanvas {
            width: 100%;
            height: 100%;
        }

        /* æ•°æ®æ¡ */
        .data-item {
            display: flex;
            align-items: center;
            margin-bottom: var(--space-2);
        }

        .data-item:last-child {
            margin-bottom: 0;
        }

        .data-label {
            flex: 0 0 90px;
            font-size: 14px;
            color: var(--gray-700);
            font-weight: 500;
        }

        .data-bar {
            flex: 1;
            height: 10px;
            background: var(--gray-200);
            border-radius: 5px;
            overflow: hidden;
            margin-right: var(--space-2);
        }

        .data-fill {
            height: 100%;
            background: var(--gradient-warm);
            border-radius: 5px;
            animation: barGrow 1s ease-out;
        }

        @keyframes barGrow {
            from {
                width: 0;
            }
        }

        .data-value {
            flex: 0 0 45px;
            font-size: 15px;
            font-weight: 600;
            color: var(--primary-500);
            text-align: right;
        }

        /* å†…å®¹å¡ç‰‡ */
        .content-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-3);
            box-shadow: var(--shadow-sm);
        }

        .content-card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .content-card-body {
            font-size: 15px;
            color: var(--gray-700);
            line-height: 1.8;
        }

        /* CTAå¡ç‰‡ */
        .cta-card {
            background: linear-gradient(135deg, rgba(108, 124, 231, 0.08) 0%, rgba(171, 123, 247, 0.08) 100%);
            border: 2px solid var(--primary-400);
            border-radius: var(--radius-xl);
            padding: var(--space-4);
            margin: var(--space-4) 0;
            text-align: center;
        }

        .cta-card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-600);
            margin-bottom: var(--space-3);
        }

        .qrcode-container {
            display: flex;
            justify-content: center;
            margin-bottom: var(--space-3);
        }

        .qrcode-image {
            width: 160px;
            height: 160px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            background: white;
            padding: 8px;
        }

        .cta-features {
            text-align: left;
            display: inline-block;
            margin-bottom: var(--space-2);
        }

        .cta-feature {
            font-size: 14px;
            color: var(--gray-700);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .cta-hint {
            font-size: 13px;
            color: var(--gray-600);
            margin-top: var(--space-2);
        }

        /* åº•éƒ¨æ“ä½œæ  */
        .bottom-actions {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: var(--space-2) var(--space-3);
            box-shadow: 0 -4px 16px rgba(0, 0, 0, 0.08);
            display: flex;
            gap: var(--space-2);
            z-index: 100;
        }

        .action-btn {
            flex: 1;
            height: 48px;
            border-radius: var(--radius-xl);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            border: none;
        }

        .action-btn:active {
            transform: scale(0.98);
        }

        .action-btn-save {
            background: linear-gradient(135deg, #51CF66 0%, #37B24D 100%);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .action-btn-test {
            background: var(--gradient-warm);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: var(--space-5);
            font-size: 16px;
            color: var(--gray-600);
        }

        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% {
                content: '.';
            }
            40% {
                content: '..';
            }
            60%, 100% {
                content: '...';
            }
        }
    </style>
</head>
<body>
    <!-- è¯­è¨€åˆ‡æ¢å™¨ -->
    <div class="lang-switcher" style="position: fixed; top: 16px; right: 24px; z-index: 1000; background: white; border-radius: 24px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12); display: flex; padding: 4px; gap: 4px;">
        <button class="lang-btn active" data-lang="zh-CN" onclick="switchLanguage('zh-CN')" style="padding: 6px 12px; border: none; background: transparent; color: #6C757D; font-size: 14px; font-weight: 500; border-radius: 12px; cursor: pointer; transition: all 300ms ease-out;">ä¸­æ–‡</button>
        <button class="lang-btn" data-lang="en-US" onclick="switchLanguage('en-US')" style="padding: 6px 12px; border: none; background: transparent; color: #6C757D; font-size: 14px; font-weight: 500; border-radius: 12px; cursor: pointer; transition: all 300ms ease-out;">EN</button>
    </div>
    <style>
        .lang-btn:hover { background: #F1F3F5 !important; }
        .lang-btn.active { background: linear-gradient(135deg, #6C7CE7 0%, #AB7BF7 100%) !important; color: white !important; }
    </style>

    <div class="wave-decoration"></div>

    <div class="result-container">
        <div class="result-content" id="app">
            <div class="loading" data-i18n="result.loading"></div>
        </div>
    </div>

    <div class="bottom-actions">
        <button class="action-btn action-btn-test" onclick="testAgain()" style="max-width: 400px; margin: 0 auto;">
            <span data-i18n-icon="ğŸ”„">ğŸ”„</span> <span data-i18n="result.retestButton"></span>
        </button>
    </div>

    <!-- i18n å¤šè¯­è¨€æ”¯æŒ -->
    <script src="i18n.js"></script>

    <script src="test-data-by-age.js"></script>
    <script src="result-types-i18n.js"></script>
    <script>
        // é¡µé¢åŠ è½½æ—¶æ¸²æŸ“
        window.addEventListener('DOMContentLoaded', () => {
            loadAndRenderResult();

            // åˆå§‹åŒ–è¯­è¨€æŒ‰é’®çŠ¶æ€
            const currentLang = i18n.getLang();
            document.querySelectorAll('.lang-btn').forEach(btn => {
                if (btn.dataset.lang === currentLang) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        });

        // åŠ è½½å¹¶æ¸²æŸ“ç»“æœ
        function loadAndRenderResult() {
            // ä» localStorage è·å–ç»“æœ
            const resultStr = localStorage.getItem('emotion_test_result');

            if (!resultStr) {
                // å¦‚æœæ²¡æœ‰ç»“æœï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ç­”æ¡ˆæ•°æ®å¯ä»¥é‡æ–°è®¡ç®—
                const answersStr = localStorage.getItem('emotion_test_answers');

                if (answersStr) {
                    const answers = JSON.parse(answersStr);
                    const ageGroup = localStorage.getItem('emotion_test_age_group') || '29-35';
                    let result = calculateResult(answers, ageGroup);
                    localStorage.setItem('emotion_test_result', JSON.stringify(result));
                    result = updateResultTexts(result);
                    renderResult(result);
                } else {
                    // éƒ½æ²¡æœ‰ï¼Œè·³è½¬å›é¦–é¡µ
                    document.getElementById('app').innerHTML = `
                        <div class="content-card" style="text-align: center; margin-top: 100px;">
                            <div style="font-size: 48px; margin-bottom: 16px;">ğŸ¤”</div>
                            <div class="content-card-title" style="justify-content: center;" data-i18n="result.notFoundTitle"></div>
                            <div class="content-card-body" style="margin-bottom: 24px;" data-i18n="result.notFoundDesc"></div>
                            <button class="btn-primary" onclick="window.location.href='landing.html'">
                                <span data-i18n="result.startButton"></span>
                            </button>
                        </div>
                    `;
                    updateLanguage();
                }
            } else {
                let result = JSON.parse(resultStr);
                result = updateResultTexts(result);
                renderResult(result);
            }
        }

        // æ ¹æ®å½“å‰è¯­è¨€æ›´æ–°ç»“æœæ–‡æœ¬
        function updateResultTexts(result) {
            // å¦‚æœç»“æœåŒ…å«levelå’Œorientationä¿¡æ¯ï¼Œé‡æ–°è·å–å¯¹åº”è¯­è¨€çš„æ–‡æœ¬
            if (result.level && result.orientation && typeof getResultType !== 'undefined') {
                const currentLang = i18n.getLang();
                const localizedType = getResultType(result.level, result.orientation, result.score, currentLang);

                if (localizedType) {
                    result.title = localizedType.title;
                    result.description = localizedType.description;
                    result.advice = localizedType.advice;
                }
            }

            // è½¬æ¢é›·è¾¾å›¾æ•°æ®ä¸ºå½“å‰è¯­è¨€
            if (result.radarData) {
                const localizedRadarData = {};
                const radarKeys = {
                    emotionalAccuracy: 'radar.emotionalAccuracy',
                    selfAwareness: 'radar.selfAwareness',
                    expressionAbility: 'radar.expressionAbility',
                    positiveOrientation: 'radar.positiveOrientation',
                    emotionalStability: 'radar.emotionalStability',
                    empathy: 'radar.empathy'
                };

                // å¦‚æœæ˜¯æ–°æ ¼å¼ï¼ˆå›ºå®šé”®åï¼‰
                if (result.radarData.emotionalAccuracy !== undefined) {
                    for (const [key, i18nKey] of Object.entries(radarKeys)) {
                        localizedRadarData[i18n.t(i18nKey)] = result.radarData[key];
                    }
                    result.radarData = localizedRadarData;
                } else {
                    // å¦‚æœæ˜¯æ—§æ ¼å¼ï¼ˆå·²ç»æ˜¯æ–‡æœ¬é”®åï¼‰ï¼Œå°è¯•è½¬æ¢
                    // æ£€æµ‹ç¬¬ä¸€ä¸ªé”®æ˜¯å¦æ˜¯ä¸­æ–‡
                    const firstKey = Object.keys(result.radarData)[0];
                    const isChinese = /[ä¸€-é¾¥]/.test(firstKey);
                    const currentLang = i18n.getLang();

                    // å¦‚æœå½“å‰è¯­è¨€ä¸æ•°æ®è¯­è¨€ä¸åŒ¹é…ï¼Œéœ€è¦è½¬æ¢
                    if ((isChinese && currentLang === 'en-US') || (!isChinese && currentLang === 'zh-CN')) {
                        // éœ€è¦è½¬æ¢ï¼Œä½¿ç”¨å›ºå®šé¡ºåº
                        const values = Object.values(result.radarData);
                        const keys = ['emotionalAccuracy', 'selfAwareness', 'expressionAbility',
                                     'positiveOrientation', 'emotionalStability', 'empathy'];

                        for (let i = 0; i < keys.length; i++) {
                            localizedRadarData[i18n.t(radarKeys[keys[i]])] = values[i];
                        }
                        result.radarData = localizedRadarData;
                    }
                }
            }

            return result;
        }

        // æ¸²æŸ“ç»“æœé¡µé¢
        function renderResult(data) {
            const app = document.getElementById('app');

            const stars = 'â˜…'.repeat(data.stars) + 'â˜†'.repeat(5 - data.stars);

            app.innerHTML = `
                <div class="result-header fade-in">
                    <div class="result-icon">${data.icon}</div>
                    <div class="result-title">${data.title}</div>
                    <div class="result-stars">${stars}</div>
                    <div class="result-score" data-i18n="result.scoreLabel"></div>
                    <div class="result-score-value">${data.score}/${data.maxScore}</div>
                    <div class="result-percentage"><span data-i18n="result.beatLabel"></span> ${data.percentage}% <span data-i18n="result.beatSuffix"></span></div>
                </div>

                <div class="radar-card fade-in">
                    <div class="radar-card-title">ğŸ“Š <span data-i18n="result.radarTitle"></span></div>
                    <div class="radar-container">
                        <canvas id="radarCanvas"></canvas>
                    </div>
                    ${Object.entries(data.radarData).map(([key, value]) => `
                        <div class="data-item">
                            <div class="data-label">${key}</div>
                            <div class="data-bar">
                                <div class="data-fill" style="width: ${value}%"></div>
                            </div>
                            <div class="data-value">${value}%</div>
                        </div>
                    `).join('')}
                </div>

                <div class="content-card fade-in">
                    <div class="content-card-title">ğŸ’ <span data-i18n="result.traitsTitle"></span></div>
                    <div class="content-card-body">${data.description}</div>
                </div>

                <div class="content-card fade-in">
                    <div class="content-card-title">ğŸ’¡ <span data-i18n="result.adviceTitle"></span></div>
                    <div class="content-card-body">${data.advice}</div>
                </div>

                <div class="cta-card fade-in">
                    <div class="cta-card-title">âœ¨ <span data-i18n="result.ctaTitle"></span></div>
                    <div class="qrcode-container">
                        <img src="./qrcode.jpg" alt="å°ç¨‹åºç " class="qrcode-image" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect width=%22200%22 height=%22200%22 fill=%22%23F8F9FA%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%236C7CE7%22 font-size=%2216%22 font-weight=%22600%22%3Eæ˜Ÿç«å¥‡ç¼˜%3C/text%3E%3C/svg%3E'">
                    </div>
                    <div class="cta-features">
                        <div class="cta-feature">âœ“ <span data-i18n="result.feature1"></span></div>
                        <div class="cta-feature">âœ“ <span data-i18n="result.feature2"></span></div>
                        <div class="cta-feature">âœ“ <span data-i18n="result.feature3"></span></div>
                        <div class="cta-feature">âœ“ <span data-i18n="result.feature4"></span></div>
                    </div>
                    <div class="cta-hint" data-i18n="result.ctaHint"></div>
                </div>
            `;

            // å»¶è¿Ÿç»˜åˆ¶é›·è¾¾å›¾ï¼Œç¡®ä¿canvaså·²æŒ‚è½½
            setTimeout(() => {
                drawRadarChart(data.radarData);
                updateLanguage(); // æ›´æ–°è¯­è¨€
            }, 100);
        }


        // è¯­è¨€åˆ‡æ¢å’Œæ›´æ–°
        function switchLanguage(lang) {
            i18n.setLang(lang);

            // é‡æ–°åŠ è½½å¹¶æ¸²æŸ“ç»“æœï¼ˆä»¥æ›´æ–°å¤šè¯­è¨€å†…å®¹ï¼‰
            loadAndRenderResult();

            updateLanguage();

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.lang-btn').forEach(btn => {
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function updateLanguage() {
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = i18n.t('result.loading') + ' - ' + i18n.t('landing.title').replace(/\n/g, ' ');

            // æ›´æ–°æ‰€æœ‰å¸¦ data-i18n å±æ€§çš„å…ƒç´ 
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                let text = i18n.t(key);

                // å¤„ç†ç‰¹æ®Šæ ¼å¼
                if (key === 'result.scoreLabel') {
                    element.textContent = text + 'ï¼š';
                } else if (key === 'result.beatSuffix') {
                    element.textContent = text;
                } else {
                    element.textContent = text;
                }
            });
        }

        // ç»˜åˆ¶é›·è¾¾å›¾
        function drawRadarChart(data) {
            const canvas = document.getElementById('radarCanvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const dpr = window.devicePixelRatio || 1;

            // è®¾ç½®canvaså®é™…å¤§å°
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);

            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            const radius = Math.min(centerX, centerY) * 0.68;

            const dataPoints = Object.values(data);
            const labels = Object.keys(data);
            const numPoints = dataPoints.length;

            // ç»˜åˆ¶èƒŒæ™¯ç½‘æ ¼ï¼ˆ3å±‚ï¼‰
            ctx.strokeStyle = 'rgba(108, 124, 231, 0.2)';
            ctx.lineWidth = 1.5;

            for (let i = 1; i <= 3; i++) {
                ctx.beginPath();
                for (let j = 0; j < numPoints; j++) {
                    const angle = (Math.PI * 2 / numPoints) * j - Math.PI / 2;
                    const r = (radius / 3) * i;
                    const x = centerX + r * Math.cos(angle);
                    const y = centerY + r * Math.sin(angle);
                    if (j === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
                ctx.stroke();
            }

            // ç»˜åˆ¶åˆ†å‰²çº¿
            ctx.strokeStyle = 'rgba(108, 124, 231, 0.15)';
            ctx.lineWidth = 1;
            for (let i = 0; i < numPoints; i++) {
                const angle = (Math.PI * 2 / numPoints) * i - Math.PI / 2;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(
                    centerX + radius * Math.cos(angle),
                    centerY + radius * Math.sin(angle)
                );
                ctx.stroke();
            }

            // ç»˜åˆ¶æ•°æ®åŒºåŸŸ
            ctx.fillStyle = 'rgba(108, 124, 231, 0.25)';
            ctx.strokeStyle = '#6C7CE7';
            ctx.lineWidth = 2.5;
            ctx.beginPath();

            dataPoints.forEach((value, i) => {
                const angle = (Math.PI * 2 / numPoints) * i - Math.PI / 2;
                const r = (radius * value) / 100;
                const x = centerX + r * Math.cos(angle);
                const y = centerY + r * Math.sin(angle);
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });

            ctx.closePath();
            ctx.fill();
            ctx.stroke();

            // ç»˜åˆ¶æ•°æ®ç‚¹
            ctx.fillStyle = '#6C7CE7';
            dataPoints.forEach((value, i) => {
                const angle = (Math.PI * 2 / numPoints) * i - Math.PI / 2;
                const r = (radius * value) / 100;
                const x = centerX + r * Math.cos(angle);
                const y = centerY + r * Math.sin(angle);

                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();

                // å¤–åœˆç™½è¾¹
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
            });

            // ç»˜åˆ¶æ ‡ç­¾
            ctx.fillStyle = '#495057';
            ctx.font = '600 13px -apple-system, BlinkMacSystemFont, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            labels.forEach((label, i) => {
                const angle = (Math.PI * 2 / numPoints) * i - Math.PI / 2;
                const r = radius + 35;
                const x = centerX + r * Math.cos(angle);
                const y = centerY + r * Math.sin(angle);

                ctx.fillText(label, x, y);
            });
        }


        // å†æµ‹ä¸€æ¬¡
        function testAgain() {
            // æ¸…é™¤ä¹‹å‰çš„æ•°æ®
            localStorage.removeItem('emotion_test_answers');
            localStorage.removeItem('emotion_test_result');
            localStorage.removeItem('emotion_test_progress');
            localStorage.removeItem('emotion_test_shared');

            // è·³è½¬åˆ°é¦–é¡µ
            window.location.href = 'landing.html';
        }
    </script>
</body>
</html>
