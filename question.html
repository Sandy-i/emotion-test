<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æƒ…ç»ªé¢—ç²’åº¦æµ‹è¯•</title>
    <link rel="stylesheet" href="common.css">
    <script src="i18n.js"></script>
    <style>
        .question-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background: var(--gray-50);
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            padding: var(--space-2) var(--space-3);
            box-shadow: var(--shadow-sm);
            z-index: 100;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-1);
        }

        .progress-text {
            font-size: 14px;
            color: var(--gray-600);
            font-weight: 500;
        }

        .progress-number {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-500);
        }

        .main-content {
            flex: 1;
            padding-top: 80px;
            padding-bottom: 40px;
        }

        .question-card {
            background: white;
            margin: var(--space-3);
            border-radius: var(--radius-lg);
            padding: var(--space-4) var(--space-3);
            box-shadow: var(--shadow-md);
            min-height: 400px;
        }

        .question-number {
            display: inline-block;
            background: var(--gradient-warm);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: var(--space-2);
        }

        .question-category {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: var(--space-3);
        }

        .question-text {
            font-size: 18px;
            line-height: 1.6;
            color: var(--gray-900);
            font-weight: 500;
            margin-bottom: var(--space-2);
        }

        .question-hint {
            font-size: 13px;
            color: var(--primary-500);
            background: linear-gradient(135deg, rgba(108, 124, 231, 0.08) 0%, rgba(171, 123, 247, 0.08) 100%);
            border-left: 3px solid var(--primary-500);
            padding: var(--space-2);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-3);
            line-height: 1.5;
        }

        .question-hint strong {
            color: var(--primary-600);
            font-weight: 600;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .option-button {
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: var(--space-3);
            text-align: left;
            font-size: 15px;
            line-height: 1.5;
            color: var(--gray-900);
            cursor: pointer;
            transition: all var(--transition-base);
            position: relative;
            overflow: hidden;
        }

        .option-button:hover {
            border-color: var(--primary-400);
            background: var(--gray-50);
        }

        .option-button.selected {
            border-color: var(--primary-500);
            background: linear-gradient(135deg, rgba(108, 124, 231, 0.1) 0%, rgba(171, 123, 247, 0.1) 100%);
            font-weight: 500;
        }

        .option-button::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--gradient-warm);
            opacity: 0;
            transition: opacity var(--transition-base);
        }

        .option-button.selected::before {
            opacity: 1;
        }

        .option-label {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--gray-100);
            color: var(--gray-600);
            text-align: center;
            line-height: 24px;
            font-size: 12px;
            font-weight: 600;
            margin-right: var(--space-1);
            transition: all var(--transition-base);
        }

        .option-button.selected .option-label {
            background: var(--primary-500);
            color: white;
        }

        .navigation {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-3);
            padding: 0 var(--space-3);
        }

        .nav-button {
            flex: 1;
            padding: var(--space-2);
            border: 2px solid var(--primary-500);
            background: white;
            color: var(--primary-500);
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-button.primary {
            background: var(--gradient-warm);
            color: white;
            border: none;
        }

        .nav-button.primary:disabled {
            background: var(--gray-300);
        }

        .nav-button:active:not(:disabled) {
            transform: scale(0.98);
        }

        /* æ·¡å…¥æ·¡å‡ºåŠ¨ç”» */
        .fade-out {
            animation: fadeOut 0.3s ease-out;
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(-20px);
            }
        }

        .fade-in-right {
            animation: fadeInRight 0.3s ease-out;
        }

        @keyframes fadeInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>
<body>
    <!-- è¯­è¨€åˆ‡æ¢å™¨ -->
    <div class="lang-switcher" style="position: fixed; top: 16px; right: 24px; z-index: 1000; background: white; border-radius: 24px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12); display: flex; padding: 4px; gap: 4px;">
        <button class="lang-btn active" data-lang="zh-CN" onclick="switchLanguage('zh-CN')" style="padding: 6px 12px; border: none; background: transparent; color: #6C757D; font-size: 14px; font-weight: 500; border-radius: 12px; cursor: pointer; transition: all 300ms ease-out;">ä¸­æ–‡</button>
        <button class="lang-btn" data-lang="en-US" onclick="switchLanguage('en-US')" style="padding: 6px 12px; border: none; background: transparent; color: #6C757D; font-size: 14px; font-weight: 500; border-radius: 12px; cursor: pointer; transition: all 300ms ease-out;">EN</button>
    </div>
    <style>
        .lang-btn:hover { background: #F1F3F5 !important; }
        .lang-btn.active { background: linear-gradient(135deg, #6C7CE7 0%, #AB7BF7 100%) !important; color: white !important; }
    </style>

    <div class="question-container">
        <!-- Header -->
        <div class="header">
            <div class="progress-info">
                <span class="progress-text">æƒ…ç»ªé¢—ç²’åº¦æµ‹è¯•</span>
                <span class="progress-number" id="progressText">1/10</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 10%"></div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="question-card fade-in-right" id="questionCard">
                <span class="question-number" id="questionNumber">ç¬¬ 1 é¢˜</span>
                <div class="question-category" id="questionCategory">å®¶åº­å…³ç³»</div>
                <div class="question-text" id="questionText">
                    å‘¨æœ«å®¶åº­èšé¤æ—¶ï¼Œçˆ¶æ¯åˆå¼€å§‹è¯¢é—®ä½ çš„å·¥ä½œã€æ”¶å…¥å’Œç»“å©šè®¡åˆ’ã€‚æ­¤åˆ»ä½ çš„æ„Ÿå—æœ€æ¥è¿‘ï¼š
                </div>

                <div class="question-hint">
                    ğŸ’¡ é€‰æ‹©<strong>æœ€æ¥è¿‘</strong>ä½ çš„æ„Ÿå— Â· å¦‚æœçº ç»“ï¼Œè¯·é€‰æ‹©ä½ çš„<strong>ç¬¬ä¸€ååº”</strong>
                </div>

                <div class="options-container" id="optionsContainer">
                    <!-- Options will be inserted here by JavaScript -->
                </div>
            </div>

            <!-- Navigation -->
            <div class="navigation">
                <button class="nav-button" id="prevButton" onclick="previousQuestion()">
                    <span data-i18n="question.prevButton"></span>
                </button>
                <button class="nav-button primary" id="nextButton" onclick="nextQuestion()" disabled>
                    <span data-i18n="question.nextButton"></span>
                </button>
            </div>
        </div>
    </div>

    <script src="test-data-by-age.js"></script>
    <script src="test-data-i18n.js"></script>
    <script>
        // è¯­è¨€åˆ‡æ¢å’Œæ›´æ–°
        function switchLanguage(lang) {
            i18n.setLang(lang);

            // é‡æ–°è·å–æœ¬åœ°åŒ–çš„é—®é¢˜æ•°æ®
            const ageGroup = localStorage.getItem('emotion_test_age_group') || '29-35';
            currentQuestions = getLocalizedQuestions(ageGroup, lang);

            updateLanguage();

            // é‡æ–°æ¸²æŸ“å½“å‰é—®é¢˜ï¼ˆåŒ…æ‹¬é€‰é¡¹ï¼‰
            renderQuestion();

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.lang-btn').forEach(btn => {
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function updateLanguage() {
            // æ›´æ–°é¡µé¢æ ‡é¢˜
            document.title = i18n.t('landing.title').replace(/\n/g, ' ');

            // æ›´æ–°è¿›åº¦æ–‡æœ¬
            const progressText = document.querySelector('.progress-text');
            if (progressText && !progressText.textContent.includes('/')) {
                progressText.textContent = i18n.t('question.progressText');
            }

            // æ›´æ–°æç¤ºæ–‡æœ¬
            const hintElements = document.querySelectorAll('.question-hint');
            hintElements.forEach(hint => {
                if (hint.textContent.includes('é€‰æ‹©') || hint.textContent.includes('Choose')) {
                    hint.innerHTML = `${i18n.t('question.hint')} <strong>${i18n.t('question.hintBold')}</strong> ${i18n.t('question.hintSuffix')}`;
                }
            });

            // æ›´æ–°æ‰€æœ‰å¸¦ data-i18n å±æ€§çš„å…ƒç´ 
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                element.textContent = i18n.t(key);
            });
        }

        
        // ==================== ç±»åˆ«ç¿»è¯‘æ”¯æŒ ====================
        const CATEGORY_TRANSLATIONS = {
            'å­¦ä¸šå‹åŠ›': 'Academic Pressure',
            'å®¿èˆå…³ç³»': 'Dorm Relationships',
            'æ‹çˆ±å…³ç³»': 'Romantic Relationships',
            'æ±‚èŒ/æœªæ¥': 'Job Hunting/Future',
            'å®¶åº­ç»æµ': 'Family Finances',
            'ç¤¾äº¤å¯¹æ¯”': 'Social Comparison',
            'å­¦ä¸š/ä¸“ä¸š': 'Studies/Major',
            'ç¤¾å›¢/é›†ä½“æ´»åŠ¨': 'Club/Group Activities',
            'ç‹¬ç«‹ç”Ÿæ´»': 'Independent Living',
            'è‡ªæˆ‘è®¤çŸ¥': 'Self-awareness',
            'èŒåœºå‹åŠ›': 'Workplace Pressure',
            'å›¢é˜Ÿåˆä½œ': 'Teamwork',
            'èŒä¸šå‘å±•': 'Career Development',
            'è´¢åŠ¡ç®¡ç†': 'Financial Management',
            'äº²å¯†å…³ç³»': 'Intimate Relationships',
            'å·¥ä½œä¸ç”Ÿæ´»å¹³è¡¡': 'Work-Life Balance',
            'äººé™…å…³ç³»': 'Interpersonal Relationships',
            'å®¶åº­è´£ä»»': 'Family Responsibilities',
            'å¥åº·ç„¦è™‘': 'Health Anxiety',
            'å­å¥³æ•™è‚²': 'Children Education',
            'å©šå§»å…³ç³»': 'Marriage',
            'å…»è€ç„¦è™‘': 'Retirement Anxiety',
            'èº«ä½“å¥åº·': 'Physical Health',
            'äººç”Ÿæ„ä¹‰': 'Life Meaning',
            'èŒåœºæ™‹å‡': 'Career Advancement',
            'äº‹ä¸šä¸å®¶åº­': 'Career vs Family'
        };

        // è·å–ç¿»è¯‘åçš„ç±»åˆ«åç§°
        function getTranslatedCategory(category) {
            const currentLang = i18n.getLang();
            if (currentLang === 'en-US') {
                return CATEGORY_TRANSLATIONS[category] || category;
            }
            return category;
        }


        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–è¯­è¨€
        window.addEventListener('load', function() {
            updateLanguage();

            // åˆå§‹åŒ–è¯­è¨€æŒ‰é’®çŠ¶æ€
            const currentLang = i18n.getLang();
            document.querySelectorAll('.lang-btn').forEach(btn => {
                if (btn.dataset.lang === currentLang) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        });


        // æ ¹æ®å¹´é¾„æ®µè·å–é¢˜ç›®
        const ageGroup = localStorage.getItem('emotion_test_age_group') || '29-35';
        let currentQuestions = getLocalizedQuestions(ageGroup, i18n.getLang());
        if (!currentQuestions) {
            alert('å¹´é¾„æ®µæ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·é‡æ–°é€‰æ‹©');
            window.location.href = 'age-select.html';
        }
        let currentQuestionIndex = 0;
        let answers = new Array(10).fill(null);

        // ä» localStorage æ¢å¤è¿›åº¦
        function loadProgress() {
            const saved = localStorage.getItem('emotion_test_answers');
            const savedProgress = localStorage.getItem('emotion_test_progress');

            if (saved) {
                answers = JSON.parse(saved);
            }

            if (savedProgress) {
                currentQuestionIndex = parseInt(savedProgress);
            }
        }

        // ä¿å­˜è¿›åº¦
        function saveProgress() {
            localStorage.setItem('emotion_test_answers', JSON.stringify(answers));
            localStorage.setItem('emotion_test_progress', currentQuestionIndex.toString());
        }

        // æ¸²æŸ“å½“å‰é—®é¢˜
        function renderQuestion() {
            const question = currentQuestions[currentQuestionIndex];

            // æ›´æ–°è¿›åº¦
            document.getElementById('progressText').textContent = `${currentQuestionIndex + 1}/10`;
            document.getElementById('progressFill').style.width = `${(currentQuestionIndex + 1) * 10}%`;

            // æ›´æ–°é—®é¢˜ä¿¡æ¯
            document.getElementById('questionNumber').textContent = `ç¬¬ ${currentQuestionIndex + 1} é¢˜`;
            document.getElementById('questionCategory').textContent = `ğŸ“ ${question.category}`;
            document.getElementById('questionText').textContent = question.scenario;

            // æ¸²æŸ“é€‰é¡¹
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const optionButton = document.createElement('button');
                optionButton.className = 'option-button';

                if (answers[currentQuestionIndex] === index) {
                    optionButton.classList.add('selected');
                }

                const labels = ['A', 'B', 'C', 'D', 'E'];
                optionButton.innerHTML = `
                    <span class="option-label">${labels[index]}</span>
                    ${option.text}
                `;

                optionButton.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionButton);
            });

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateNavigationButtons();

            // æ·»åŠ æ·¡å…¥åŠ¨ç”»
            const card = document.getElementById('questionCard');
            card.classList.remove('fade-in-right');
            void card.offsetWidth; // è§¦å‘é‡æ’
            card.classList.add('fade-in-right');
        }

        // é€‰æ‹©é€‰é¡¹
        function selectOption(optionIndex) {
            answers[currentQuestionIndex] = optionIndex;
            saveProgress();

            // æ›´æ–°UI
            const options = document.querySelectorAll('.option-button');
            options.forEach((btn, index) => {
                if (index === optionIndex) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            });

            updateNavigationButtons();

            // å¦‚æœä¸æ˜¯æœ€åä¸€é¢˜ï¼Œ800msåè‡ªåŠ¨è·³è½¬åˆ°ä¸‹ä¸€é¢˜
            if (currentQuestionIndex < 9) {
                setTimeout(() => {
                    nextQuestion();
                }, 600);
            }
        }

        // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
        function updateNavigationButtons() {
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');

            // ä¸Šä¸€é¢˜æŒ‰é’®
            prevButton.disabled = currentQuestionIndex === 0;

            // ä¸‹ä¸€é¢˜æŒ‰é’®
            const hasAnswer = answers[currentQuestionIndex] !== null;
            nextButton.disabled = !hasAnswer;

            // å¦‚æœæ˜¯æœ€åä¸€é¢˜ï¼Œæ”¹å˜æŒ‰é’®æ–‡å­—
            if (currentQuestionIndex === 9) {
                nextButton.textContent = '<span data-i18n="question.submitButton"></span>';
            } else {
                nextButton.textContent = '<span data-i18n="question.nextButton"></span>';
            }
        }

        // ä¸Šä¸€é¢˜
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                saveProgress();
                renderQuestion();
            }
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            if (answers[currentQuestionIndex] === null) {
                return;
            }

            if (currentQuestionIndex < 9) {
                currentQuestionIndex++;
                saveProgress();
                renderQuestion();
            } else {
                // å®Œæˆæµ‹è¯•ï¼Œè®¡ç®—ç»“æœå¹¶è·³è½¬åˆ°ç»“æœé¡µ
                const result = calculateResult(answers, ageGroup);
                localStorage.setItem('emotion_test_result', JSON.stringify(result));
                window.location.href = 'share-gate-ç®€åŒ–ç‰ˆ.html';
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadProgress();
            renderQuestion();
        });

        // é”®ç›˜å¯¼èˆªæ”¯æŒ
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft' && currentQuestionIndex > 0) {
                previousQuestion();
            } else if (e.key === 'ArrowRight' && answers[currentQuestionIndex] !== null) {
                nextQuestion();
            } else if (e.key >= '1' && e.key <= '5') {
                const optionIndex = parseInt(e.key) - 1;
                if (optionIndex < currentQuestions[currentQuestionIndex].options.length) {
                    selectOption(optionIndex);
                }
            }
        });
    </script>
</body>
</html>
